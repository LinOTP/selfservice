<form [formGroup]="loginFormGroup"
      (ngSubmit)="login()"
      *ngIf="loginStage === 1">
  <mat-card id="loginCard">
    <mat-card-title i18n="card header|login page title">Login</mat-card-title>
    <mat-card-content>
      <mat-form-field>
        <input matInput
               formControlName="username"
               name="username"
               placeholder="Username"
               i18n-placeholder
               autocomplete="username"
               appFocusOnInit>
      </mat-form-field>
      <mat-form-field *ngIf="systemInfo?.realm_box">
        <mat-label i18n>Realm</mat-label>
        <mat-select formControlName="realm">
          <mat-option *ngFor="let realm of systemInfo.realms | keyvalue"
                      [value]="realm.key">
            {{realm.value.realmname}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field>
        <input matInput
               type="password"
               formControlName="password"
               name="password"
               placeholder="Password"
               i18n-placeholder
               autocomplete="current-password">
      </mat-form-field>
    </mat-card-content>
    <mat-card-actions>
      <button mat-raised-button
              type="submit"
              color="primary"
              i18n="login action|login page submit button">Login</button>
    </mat-card-actions>
  </mat-card>
</form>

<div *ngIf="loginStage === 2">
  <mat-card id="loginCard">
    <mat-card-title i18n="card header|login page title">Login</mat-card-title>
    <mat-card-content>
      <div *ngIf="factors && factors.length > 0; else noFactors">
        <p>Please select which token to use as your second factor:</p>
        <mat-form-field>
          <mat-select [(ngModel)]="selectedToken"
                      appFocusOnInit>
            <mat-option *ngFor="let token of factors"
                        [value]="token">
              <strong>{{ token.typeDetails.type | capitalize}}</strong> {{token.serial}} ({{ token.description }})
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <ng-template #noFactors>
        <p>You do not own any valid tokens or there was a problem retrieving them from the server.
          Please contact an administrator.</p>
      </ng-template>
    </mat-card-content>
    <mat-card-actions>
      <button mat-button
              type="reset"
              color="primary"
              (click)="resetAuthForm()"
              i18n="2nd factor login action|login page second factor cancel button">Cancel</button>
      <button mat-raised-button
              type="submit"
              (click)="chooseSecondFactor(selectedToken)"
              color="primary"
              i18n="2nd factor login action|login page second factor submit button">Submit</button>
    </mat-card-actions>
  </mat-card>
</div>

<form [formGroup]="secondFactorFormGroup"
      (ngSubmit)="submitSecondFactor()"
      *ngIf="loginStage === 3">
  <mat-card id="loginCard">
    <mat-card-title i18n="card header|login page title">Login</mat-card-title>
    <mat-card-content>
      <mat-form-field>
        <input matInput
               formControlName="otp"
               placeholder="OTP"
               name="otp"
               i18n-placeholder
               autocomplete="one-time-code"
               appFocusOnInit>
      </mat-form-field>
    </mat-card-content>
    <mat-card-actions>
      <button mat-button
              type="reset"
              color="primary"
              (click)="resetAuthForm()"
              i18n="2nd factor login action|login page second factor cancel button">Cancel</button>
      <button mat-raised-button
              type="submit"
              color="primary"
              i18n="2nd factor login action|login page second factor submit button">Submit</button>
    </mat-card-actions>
  </mat-card>
</form>
